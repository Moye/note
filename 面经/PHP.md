



# 常见的PHP面试题

## 1. PHP中array是如何实现的？

**PHP**中的数组既可以是连续的数组，也可以是存储K-V映射的map。本质上，PHP数组是一个有序的字典。它必须满足以下以下两条语义：

- PHP数字是一个字典，存储着键-值对。通过键可以快速地找到对应的值，键可以使整型，也可以是字符串。
- PHP数组是有序的。这个有序指的是插入顺序，即遍历数组时，遍历元素的顺序应该和插入顺序一致，而不像普通字典一样是随机的。

![HashTable示意图](../pic/php-array-1.jpeg)

图1 HashTable示意图

> 注：上图中有两个哈希函数，可能原因是：
>
> - HashTable中的key可能是数字，也可能是字符串，所以bucket在设计key的时候，需要做拆分，拆分成数字key和字符串key，在上图的bucket中，“h"代表数字key，“key"代表字符串key。实际上，对于数字key，hash1函数没有做任何事情，h值就是数字key。
> - 每一个字符串key，经过hash1函数都会计算出一个h值。这个h值可以加快字符串key之间的比较速度。如果要比较两个字符串key1和key2是否相等，会首先比较key1和key2的h值是否相等，如果相等，再去比较字符串的长度及内容。否则，可直接判定key1和key2不相等。在大部分场景中，不同字符串的h值都不会发生碰撞，这大大提高了HashTable插入、查找的速度。

为了实现语义一，PHP用HashTable来存储键-值对。但HashTable并不能保证语义二。为了实现语义二，PHP不同版本对HashTable进行了一些额外的设计来保证有序。

- PHP5**中是通过维护一个全局变量，两个指针分别指向这个全局链表的头和尾，所以PHP5中的遍历实现，其实就是遍历了这个双向链表。
- **PHP7**同样是使用**链地址法**解决**哈希冲突**。不同的是，PHP5的链表是物理上的链表，链表中bucket之间的上下游关系通过真实存在的指针来维护。而PHP7的链表是通过一直逻辑上的链表，所有bucket都分配在连续的数组内存中，不再通过指针维护上下游关系，每个bucket只维护下一个bucket在数组中的索引（因为是连续内存，通过索引可以快速定位到bucket）。即可完成链表上bucket的遍历。





